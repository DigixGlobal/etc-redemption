'use strict';

var Command = require('ronin').Command;
var utils = require('../../utils');

module.exports = Command.extend({
  desc: 'Show some diagnostic information on the bitswap agent.',

  options: {},

  run: function run() {
    utils.getIPFS(function (err, ipfs) {
      if (err) {
        throw err;
      }

      ipfs.bitswap.stat(function (err, stats) {
        if (err) {
          throw err;
        }

        stats.Wantlist = stats.Wantlist || [];
        stats.Peers = stats.Peers || [];

        console.log('\nbitswap status\n  blocks received: ' + stats.BlocksReceived + '\n  dup blocks received: ' + stats.DupBlksReceived + '\n  dup data received: ' + stats.DupDataReceived + 'B\n  wantlist [' + stats.Wantlist.length + ' keys]\n    ' + stats.Wantlist.join('\n    ') + '\n  partners [' + stats.Peers.length + ']\n    ' + stats.Peers.join('\n    '));
      });
    });
  }
});