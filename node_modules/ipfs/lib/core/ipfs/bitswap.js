'use strict';

var OFFLINE_ERROR = require('../utils').OFFLINE_ERROR;

function formatWantlist(list) {
  return Array.from(list).map(function (e) {
    return e[0];
  });
}

module.exports = function bitswap(self) {
  return {
    wantlist: function wantlist() {
      if (!self.isOnline()) {
        throw OFFLINE_ERROR;
      }

      var list = self._bitswap.getWantlist();
      return formatWantlist(list);
    },
    stat: function stat() {
      if (!self.isOnline()) {
        throw OFFLINE_ERROR;
      }

      var stats = self._bitswap.stat();
      stats.wantlist = formatWantlist(stats.wantlist);
      stats.peers = stats.peers.map(function (id) {
        return id.toB58String();
      });

      return stats;
    },
    unwant: function unwant(key) {
      if (!self.isOnline()) {
        throw OFFLINE_ERROR;
      }

      // TODO: implement when https://github.com/ipfs/js-ipfs-bitswap/pull/10 is merged
    }
  };
};